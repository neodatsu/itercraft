# Itercraft MQTT Broker Configuration
# Security-first configuration: TLS only, authenticated access

# =============================================================================
# General Settings
# =============================================================================
per_listener_settings true
persistence true
persistence_location /mosquitto/data/
log_dest stdout
log_type all
connection_messages true

# =============================================================================
# TLS Listener (Port 8883) - Primary and ONLY listener
# =============================================================================
listener 8883
protocol mqtt

# TLS Configuration
cafile /mosquitto/config/certs/ca.crt
certfile /mosquitto/config/certs/server.crt
keyfile /mosquitto/config/certs/server.key
tls_version tlsv1.2
# TLS 1.2+ ciphers (secure defaults)
ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256

# Require client certificate (mutual TLS) - optional but recommended
# require_certificate true
# use_identity_as_username true

# =============================================================================
# Authentication
# =============================================================================
allow_anonymous false
password_file /mosquitto/config/passwd

# =============================================================================
# Authorization (ACL)
# =============================================================================
acl_file /mosquitto/config/acl.conf

# =============================================================================
# Security Hardening
# =============================================================================
# Maximum connections
max_connections 100

# Maximum QoS
max_qos 2

# Maximum packet size (256KB)
max_packet_size 262144

# Keep alive settings
max_keepalive 120

# Message size limits
message_size_limit 262144

# Client ID requirements
use_username_as_clientid false
