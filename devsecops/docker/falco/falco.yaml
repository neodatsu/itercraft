# Falco configuration for Itercraft
# Runtime security monitoring

json_output: true
json_include_output_property: true
json_include_tags_property: true

log_stderr: true
log_syslog: false
log_level: info

priority: notice

buffered_outputs: false

outputs_queue:
  capacity: 0

# Use modern eBPF engine (built-in, no external driver needed)
engine:
  kind: modern_ebpf

# File output for Promtail to scrape
file_output:
  enabled: true
  keep_alive: false
  filename: /var/log/falco/events.json

# Stdout for docker logs
stdout_output:
  enabled: true

# HTTP webhook for Grafana/Slack alerting via Falcosidekick
http_output:
  enabled: true
  url: http://falcosidekick:2801
  user_agent: "falco/itercraft"

# gRPC disabled (using HTTP output to Falcosidekick)
grpc:
  enabled: false

grpc_output:
  enabled: false

# Syscall event source
syscall_event_drops:
  threshold: 0.1
  actions:
    - log
    - alert
  rate: 0.03333
  max_burst: 1

# Watch for new containers
watch_config_files: true

# Rules files
rules_files:
  - /etc/falco/falco_rules.yaml
  - /etc/falco/rules.d
